package main

import (
	"fmt"
	"sync"

	"github.com/karinaSelezneva/minipub/internal/broker"
)

func main() {
	b := broker.NewBroker()
	var wg sync.WaitGroup

	topic := "sport"
	ch := b.Subscribe(topic)

	wg.Add(1)

	go func() {
		defer wg.Done()

		// –ß–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ 1 —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è
		// –ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Ü–∏–∫–ª for range, —Ç–æ –±—Ä–æ–∫–µ—Ä –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –∑–∞–∫—Ä—ã–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã
		msg, ok := <-ch
		if ok {
			fmt.Printf("‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –≤ main: %s\n", msg)
		}
	}()

	// –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
	b.Publish(topic, "–ü—Ä–∏–≤–µ—Ç –∏–∑ main!")

	// –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω—ã
	wg.Wait()

	fmt.Println("üöÄ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, –≤—ã—Ö–æ–¥–∏–º.")
}

// –¢–µ—Å—Ç –≤ main.go:
// 1. –í main —Å–æ–∑–¥–∞–π –±—Ä–æ–∫–µ—Ä.
// 2. –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ —Ç–æ–ø–∏–∫ "news", –ø–æ–ª—É—á–∏–≤ –∫–∞–Ω–∞–ª.
// 3. –ó–∞–ø—É—Å—Ç–∏ –≥–æ—Ä—É—Ç–∏–Ω—É, –∫–æ—Ç–æ—Ä–∞—è —á–∏—Ç–∞–µ—Ç –∏–∑ —ç—Ç–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ –∏ –ø–µ—á–∞—Ç–∞–µ—Ç —Ç–µ–∫—Å—Ç.
// 4. –í—ã–∑–æ–≤–∏ Publish("news", "Hello Go!").
// 5. –ë–æ–Ω—É—Å–Ω–∞—è –ø–æ–¥–∑–∞–¥–∞—á–∞: –ü–æ–ø—Ä–æ–±—É–π —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã Publish –∑–∞–ø—É—Å–∫–∞–ª –≥–æ—Ä—É—Ç–∏–Ω—É –Ω–∞ –∫–∞–∂–¥—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–¥–ø–∏—Å—á–∏–∫—É.
